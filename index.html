import React, { useState, useEffect } from 'react';
import { Sun, Moon, Zap, Heart, Sword, Sparkles, Clock, Settings, Book, Eye, Star } from 'lucide-react';

const PlanetaryHoursApp = () => {
  const [currentView, setCurrentView] = useState('hours');
  const [location, setLocation] = useState({ lat: 40.7128, lon: -74.0060, city: "New York, NY, USA" });
  const [birthLocation, setBirthLocation] = useState({ lat: 40.7128, lon: -74.0060, city: "New York, NY, USA" });
  const [hours, setHours] = useState([]);
  const [currentHour, setCurrentHour] = useState(null);
  const [currentDate, setCurrentDate] = useState(new Date());
  const [birthData, setBirthData] = useState(null);
  const [natalChart, setNatalChart] = useState(null);
  const [selectedHour, setSelectedHour] = useState(null);
  const [ritualMode, setRitualMode] = useState(false);
  const [scryingMode, setScryingMode] = useState(false);
  const [locationInput, setLocationInput] = useState("");
  const [birthDateInput, setBirthDateInput] = useState("");
  const [birthTimeInput, setBirthTimeInput] = useState("");
  const [birthLocationInput, setBirthLocationInput] = useState("");

  // Constants
  const CHALDEAN_ORDER = ["Saturn", "Jupiter", "Mars", "Sun", "Venus", "Mercury", "Moon"];
  const DAY_RULERS = ["Sun", "Moon", "Mars", "Mercury", "Jupiter", "Venus", "Saturn"];
  const DAY_NAMES = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];
  
  const PLANET_DETAILS = {
    Sun: { symbol: "‚òâ", color: "#FFD700", icon: Sun },
    Moon: { symbol: "‚òΩ", color: "#C0C0C0", icon: Moon },
    Mercury: { symbol: "‚òø", color: "#FFA500", icon: Zap },
    Venus: { symbol: "‚ôÄ", color: "#FF69B4", icon: Heart },
    Mars: { symbol: "‚ôÇ", color: "#FF4500", icon: Sword },
    Jupiter: { symbol: "‚ôÉ", color: "#4169E1", icon: Sparkles },
    Saturn: { symbol: "‚ôÑ", color: "#708090", icon: Clock }
  };

  const ZODIAC_SIGNS = [
    { name: "Aries", symbol: "‚ôà", start: 0 },
    { name: "Taurus", symbol: "‚ôâ", start: 30 },
    { name: "Gemini", symbol: "‚ôä", start: 60 },
    { name: "Cancer", symbol: "‚ôã", start: 90 },
    { name: "Leo", symbol: "‚ôå", start: 120 },
    { name: "Virgo", symbol: "‚ôç", start: 150 },
    { name: "Libra", symbol: "‚ôé", start: 180 },
    { name: "Scorpio", symbol: "‚ôè", start: 210 },
    { name: "Sagittarius", symbol: "‚ôê", start: 240 },
    { name: "Capricorn", symbol: "‚ôë", start: 270 },
    { name: "Aquarius", symbol: "‚ôí", start: 300 },
    { name: "Pisces", symbol: "‚ôì", start: 330 }
  ];

  const PLANET_DIGNITIES = {
    Sun: { exaltation: "Aries", detriment: "Aquarius", fall: "Libra" },
    Moon: { exaltation: "Taurus", detriment: "Capricorn", fall: "Scorpio" },
    Mercury: { exaltation: "Virgo", detriment: "Sagittarius", fall: "Pisces" },
    Venus: { exaltation: "Pisces", detriment: "Aries", fall: "Virgo" },
    Mars: { exaltation: "Capricorn", detriment: "Libra", fall: "Cancer" },
    Jupiter: { exaltation: "Cancer", detriment: "Gemini", fall: "Capricorn" },
    Saturn: { exaltation: "Libra", detriment: "Cancer", fall: "Aries" }
  };

  const PLANET_CORRESPONDENCES = {
    Saturn: {
      archangel: "Cassiel",
      intelligence: "Agiel",
      spirit: "Zazel",
      metal: "Lead",
      incense: "Galbanum, scammony, pepper-wort, indigo resin",
      crystals: "Sapphire, Onyx, Jet, Lapis Lazuli",
      action: "Restriction, endurance, structure",
      caution: "Avoid melancholy",
      suitable: "Bindings, hexes, psychic defence, spiritualism, ageing",
      divineNames: "Binah, Jehovah Elohim",
      keywords: "Saturnine, Structure, Discipline, Restriction",
      powerWords: "VINDEX (Sun-Saturn), SAUROCTONOS (Mars-Saturn)"
    },
    Jupiter: {
      archangel: "Zadkiel",
      intelligence: "Jophiel",
      spirit: "Hismael",
      metal: "Tin",
      incense: "Nutmeg, cloves, cedar, oak moss",
      crystals: "Amethyst, Lapis Lazuli, Emerald",
      action: "Expansion, justice, wisdom",
      caution: "Avoid excess or arrogance",
      suitable: "Money, prosperity, honours, male virility, grandeur",
      divineNames: "El, Adonai",
      keywords: "Jovial, Expansion, Abundance, Wisdom",
      powerWords: "NAOS (Opens paths Jupiter-Saturn)"
    },
    Mars: {
      archangel: "Camael",
      intelligence: "Graphiel",
      spirit: "Bartzabel",
      metal: "Iron",
      incense: "Red sanders, cypress, myrrh, ginger",
      crystals: "Ruby, Garnet, Bloodstone, Red Jasper",
      action: "Force, separation, courage",
      caution: "Avoid anger and rash acts",
      suitable: "Courage, war, fighting, power, beating of enemies, men's mysteries",
      divineNames: "Elohim Gibor",
      keywords: "Martial, Courage, Force, Victory",
      powerWords: "DAVCINA (Mars-Jupiter enchantment)"
    },
    Sun: {
      archangel: "Michael",
      intelligence: "Nakhiel",
      spirit: "Sorath",
      metal: "Gold",
      incense: "Frankincense, benzoin, cinnamon, musk",
      crystals: "Topaz, Diamond, Amber, Sunstone",
      action: "Authority, illumination, alignment with purpose",
      caution: "Avoid ego-driven action",
      suitable: "Power, riches, glory, success, honour",
      divineNames: "Eloah, Adonai, Jehovah",
      keywords: "Agile, Venerable, Fiery, Bright",
      powerWords: "ATAZOTH (Cosmic cycles)"
    },
    Venus: {
      archangel: "Hanael",
      intelligence: "Hagiel",
      spirit: "Kedemel",
      metal: "Copper",
      incense: "Roses, violets, saffron, benzoin",
      crystals: "Emerald, Jade, Rose Quartz, Pearl",
      action: "Harmony, attraction, reconciliation",
      caution: "Avoid indulgence",
      suitable: "Love, romance, sex, friendship, beauty, money, art",
      divineNames: "Jehovah, Elohim, Agiel",
      keywords: "Venerable, Harmony, Love, Beauty",
      powerWords: "Laughter-Loving Queen"
    },
    Mercury: {
      archangel: "Raphael",
      intelligence: "Tiriel",
      spirit: "Taphtatharath",
      metal: "Brass",
      incense: "Cinnamon, mace, lavender, fennel",
      crystals: "Agate, Carnelian, Labradorite, Quartz",
      action: "Communication, learning, symbolic work",
      caution: "Avoid deception or haste",
      suitable: "Healing, intelligence, divination, business",
      divineNames: "Elohim Tzabaoth",
      keywords: "Mercurial, Communication, Intellect, Speedy",
      powerWords: "Sulphur (descriptor)"
    },
    Moon: {
      archangel: "Gabriel",
      intelligence: "Malkah beTarshishim ve-ad Ruachoth Shechalim",
      spirit: "Shadbarshemoth Sharthathan",
      metal: "Silver",
      incense: "Jasmine, willow, sandalwood, cardamom",
      crystals: "Moonstone, Pearl, Selenite, Opal",
      action: "Reflection, memory, psychic sensitivity",
      caution: "Avoid instability or emotional excess",
      suitable: "Maternal love, nurturing, female mysteries, travel",
      divineNames: "Shaddai, Elim",
      keywords: "Clairvoyance, Memory, Cycles",
      powerWords: "Silver light, Night's torch"
    }
  };

  const ORPHIC_HYMNS = {
    Sun: `Golden Titan, eternal eye divine,
Illuminating all with radiant shine.
Self-born and unwearied, light you spread,
Mirror of delight to all overhead.

Lord of seasons, fiery car you guide,
With leaping coursers beaming far and wide.
Right hand brings morning's gentle light,
Left hand fathers the coming night.

Venerable Sun, agile and bright,
Across the heavens you take your flight.
Guide of good, foe to wicked ways,
Propitious ruler of all our days.

Father of ages, commander supreme,
Source of existence, pure fiery gleam.
Great eye of Nature, justice dispense,
Bless these rites with thy radiance.`,

    Moon: `Silver goddess, diffusing gentle light,
Bull-horned wanderer through the gloom of night.
With stars surrounded, circuit wide,
Night's torch extending, through heavens you ride.

Female and male, borrowed rays shine,
Full-orbed now, now to decline.
Mother of ages, fruit-producing Moon,
Amber orb making night's reflected noon.

Lover of vigilance, foe of strife,
Rejoicing in peace and prudent life.
Fair lamp of night, friend and ornament true,
Grant Nature's works their destined view.

Queen of stars, all-wise hail,
In graceful robe and shining veil.
Blessed goddess, starry and bright,
Shine on these rites with chaste splendid light.`,

    Mercury: `Hermes divine, to my prayer incline,
Angel of Jove and Maia's son so fine.
Studious of contests, ruler of mankind,
Almighty heart with prudent mind.

Celestial messenger of varied skill,
Watchful Argus fell to thy will.
Winged feet through air you course,
Friend of man, prophet of discourse.

Great life-supporter, joy is thine,
In gymnastic arts and fraud divine.
All language you explain with power,
Care's loosener in every hour.

Rod of peace within your hand,
Profitable god of every land.
Assist my works with graceful speech,
Memory's increase within my reach.`,

    Venus: `Heavenly one, laughter-loving queen,
Sea-born, night-loving, of awesome mien.
From you necessity first came,
All-connecting, nightly dame.

Yours to join the world in harmony,
All things spring from power divine and free.
Triple Fates ruled by thy decree,
All productions yielding unto thee.

Source of persuasion, secretly fav'ring,
Illustrious born, both seen and unseen wavering.
Mother of loves whom banquets delight,
Charming to sight, both day and night.

Cyprus-born, to my prayer incline,
Whether in heavens you shine,
Or pleased in sacred temple to preside,
Come all-attractive, be my guide.`,

    Mars: `Brass-beating power, minister of war,
Guard of arms, instruments of lore.
Blessed frames compose heaven, earth, and sea,
From whose breath all animals be.

Deathless warrior, by power alone,
Sacred rites to mortals shown.
Who shake old Ocean thundering to sky,
Stubborn oaks with branches high.

In glittering arms the earth you beat,
With leaping rapid sounding feet.
Every beast the noise terrific flies,
Tumult wanders through the skies.

Immortal strength, to your power consigned,
Task to protect all of mankind.
Aerial-formed, in heaven you shine,
Assist these works, courage divine.`,

    Jupiter: `Much-honored Jove, supremely great,
Holy rites to thee we consecrate.
Prayers and rites, king divine,
All things round thy head shine.

Earth is thine, mountains swelling high,
Sea profound and all the sky.
King descending from above,
Magnanimous commanding Jove.

All-parent, principle and end,
Almighty power on which we depend.
Nature trembles at thy nod,
Loud-sounding, thundering god.

Source of abundance, purifying king,
From whom all natures spring.
Hear my prayer, give health divine,
Peace and wealth, forever thine.`,

    Saturn: `Ethereal father, mighty Titan hear,
Great fire of gods and men revere.
Endued with council pure and strong,
Perfection and decrease belong.

Forms that hourly die consumed by thee,
Restored by thee to former place be.
World immense in chains you bind,
Strong ineffable power of mind.

Father of vast eternity divine,
Mighty Saturn, speech is thine.
Venerable root from which being shoots,
No power can enclose thy routes.

Best of beings, subtle mind,
To holy prayers be inclined.
Sacred rites benevolent attend,
Grant blameless life, blessed end.`
  };

  // Astronomical calculations
  const RAD = Math.PI / 180;
  const J1970 = 2440587.5;
  const J2000 = 2451545.0;

  const toJulian = (date) => date.valueOf() / 86400000 - 0.5 + J1970;
  const fromJulian = (j) => new Date((j + 0.5 - J1970) * 86400000);
  const normalize = (deg) => (deg % 360 + 360) % 360;

  const getSunTimes = (date, lat, lon) => {
    const phi = RAD * lat;
    const lw = RAD * -lon;
    const d = toJulian(date) - J2000;
    const M = RAD * (357.5291 + 0.98560028 * d);
    const C = RAD * (1.9148 * Math.sin(M) + 0.0200 * Math.sin(2 * M));
    const P = RAD * 102.9372;
    const L = M + C + P + Math.PI;
    const dec = Math.asin(Math.sin(L) * Math.sin(RAD * 23.44));
    const H = Math.acos((Math.sin(RAD * -0.83) - Math.sin(phi) * Math.sin(dec)) / (Math.cos(phi) * Math.cos(dec)));
    const Jtransit = J2000 + d + lw / (2 * Math.PI);
    
    return {
      sunrise: fromJulian(Jtransit - H / (2 * Math.PI)),
      sunset: fromJulian(Jtransit + H / (2 * Math.PI))
    };
  };

  const planetLongitudes = (date) => {
    const d = toJulian(date) - 2451545.0;
    const sunL0 = normalize(280.46646 + 0.9856474 * d);
    const sunM = normalize(357.52911 + 0.9856003 * d);
    const sunC = 1.914602 * Math.sin(sunM * RAD);
    const moonL0 = normalize(218.316 + 13.176396 * d);
    const moonM = normalize(134.963 + 13.064993 * d);
    
    return {
      Sun: normalize(sunL0 + sunC),
      Moon: normalize(moonL0 + 6.289 * Math.sin(moonM * RAD)),
      Mercury: normalize(252.250 + 4.09233445 * d),
      Venus: normalize(181.979 + 1.60213034 * d),
      Mars: normalize(355.433 + 0.52403840 * d),
      Jupiter: normalize(34.351 + 0.08308677 * d),
      Saturn: normalize(50.077 + 0.03344414 * d)
    };
  };

  const getZodiacFromLongitude = (deg) => {
    const longitude = normalize(deg);
    for (let i = ZODIAC_SIGNS.length - 1; i >= 0; i--) {
      if (longitude >= ZODIAC_SIGNS[i].start) {
        return ZODIAC_SIGNS[i];
      }
    }
    return ZODIAC_SIGNS[0];
  };

  const getDignity = (planet, zodiacName) => {
    const dig = PLANET_DIGNITIES[planet];
    if (!dig) return "Neutral";
    if (zodiacName === dig.exaltation) return "Exaltation";
    if (zodiacName === dig.detriment) return "Detriment";
    if (zodiacName === dig.fall) return "Fall";
    return "Neutral";
  };

  const getHourStrength = (planet, zodiacName, natalMatch = false) => {
    let score = 1;
    const dignity = getDignity(planet, zodiacName);
    if (dignity === "Exaltation") score += 2;
    if (dignity === "Neutral") score += 1;
    if (dignity === "Detriment") score -= 1;
    if (dignity === "Fall") score -= 2;
    if (natalMatch) score += 1;
    return score;
  };

  const generatePlanetaryHours = (dayRuler, sunrise, sunset) => {
    const hours = [];
    const nextSunrise = new Date(sunrise.getTime() + 24 * 60 * 60 * 1000);
    const dayLength = (sunset - sunrise) / 12;
    const nightLength = (nextSunrise - sunset) / 12;
    let startIndex = CHALDEAN_ORDER.indexOf(dayRuler);
    if (startIndex === -1) startIndex = 0;

    for (let i = 0; i < 24; i++) {
      const planetIndex = (startIndex + i) % 7;
      const planetName = CHALDEAN_ORDER[planetIndex];
      const planet = PLANET_DETAILS[planetName];
      const start = new Date(i < 12 ? sunrise.getTime() + i * dayLength : sunset.getTime() + (i - 12) * nightLength);
      const end = new Date(i < 12 ? sunrise.getTime() + (i + 1) * dayLength : sunset.getTime() + (i - 11) * nightLength);
      
      const zodiac = getZodiacFromLongitude(planetLongitudes(start)[planetName]);
      const dignity = getDignity(planetName, zodiac.name);
      
      let natalMatch = false;
      if (birthData && natalChart) {
        const natalPlanet = natalChart.find(p => p.planet === planetName);
        if (natalPlanet && natalPlanet.zodiac.name === zodiac.name) {
          natalMatch = true;
        }
      }
      
      const strength = getHourStrength(planetName, zodiac.name, natalMatch);
      
      hours.push({ 
        planet: { name: planetName, ...planet },
        start, 
        end,
        zodiac,
        dignity,
        strength,
        natalMatch,
        isDayHour: i < 12
      });
    }
    return hours;
  };

  const calculateHours = () => {
    const now = new Date();
    const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
    const dayRuler = DAY_RULERS[today.getDay()];
    
    try {
      const sunTimes = getSunTimes(today, location.lat, location.lon);
      const planetaryHours = generatePlanetaryHours(dayRuler, sunTimes.sunrise, sunTimes.sunset);
      setHours(planetaryHours);
      setCurrentHour(planetaryHours.find(h => now >= h.start && now < h.end));
    } catch (error) {
      console.error('Error calculating hours:', error);
    }
  };

  const calculateNatalChart = () => {
    if (!birthData) return;
    
    try {
      const birthDateTime = new Date(`${birthData.date}T${birthData.time}`);
      const longs = planetLongitudes(birthDateTime);
      const chart = Object.keys(longs).map(planet => ({
        planet,
        longitude: longs[planet],
        zodiac: getZodiacFromLongitude(longs[planet])
      }));
      setNatalChart(chart);
    } catch (error) {
      console.error('Error calculating natal chart:', error);
    }
  };

  const updateLocation = async () => {
    if (!locationInput) return;
    
    const query = locationInput.includes(',') && locationInput.split(',').length > 2 
      ? locationInput 
      : locationInput.includes(',') 
        ? `${locationInput}, USA` 
        : `${locationInput}, USA`;
    
    try {
      const response = await fetch(
        `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(query)}`,
        { headers: { "User-Agent": "PlanetaryHoursApp/3.0" } }
      );
      
      const data = await response.json();
      if (data && data.length > 0) {
        setLocation({
          lat: parseFloat(data[0].lat),
          lon: parseFloat(data[0].lon),
          city: locationInput
        });
        alert('Location updated successfully!');
      } else {
        alert('Location not found. Please try a different query.');
      }
    } catch (error) {
      console.error('Error updating location:', error);
      alert('Error connecting to location service.');
    }
  };

  const saveBirthData = async () => {
    if (!birthDateInput || !birthTimeInput || !birthLocationInput) {
      alert('Please fill in all birth data fields.');
      return;
    }

    const query = birthLocationInput.includes(',') && birthLocationInput.split(',').length > 2 
      ? birthLocationInput 
      : birthLocationInput.includes(',') 
        ? `${birthLocationInput}, USA` 
        : `${birthLocationInput}, USA`;
    
    try {
      const response = await fetch(
        `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(query)}`,
        { headers: { "User-Agent": "PlanetaryHoursApp/3.0" } }
      );
      
      const data = await response.json();
      if (data && data.length > 0) {
        setBirthLocation({
          lat: parseFloat(data[0].lat),
          lon: parseFloat(data[0].lon),
          city: birthLocationInput
        });
        setBirthData({
          date: birthDateInput,
          time: birthTimeInput,
          location: birthLocationInput
        });
        alert('Birth data saved successfully!');
      } else {
        alert('Birth location not found.');
      }
    } catch (error) {
      console.error('Error saving birth data:', error);
      alert('Error processing birth location.');
    }
  };

  const formatTime = (date) => {
    return date.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
  };

  const getTimeRemaining = (endTime) => {
    const now = new Date();
    const diff = endTime - now;
    if (diff < 0) return "Ended";
    const minutes = Math.floor(diff / 60000);
    const hours = Math.floor(minutes / 60);
    const mins = minutes % 60;
    return `${hours}h ${mins}m remaining`;
  };

  useEffect(() => {
    calculateHours();
    const interval = setInterval(() => {
      setCurrentDate(new Date());
      calculateHours();
    }, 60000);
    return () => clearInterval(interval);
  }, [location]);

  useEffect(() => {
    if (birthData) {
      calculateNatalChart();
    }
  }, [birthData]);

  // Scrying Mode Component
  const ScryingMode = () => (
    <div className="fixed inset-0 bg-black z-50 flex items-center justify-center">
      <div className="relative w-full h-full">
        <div className="absolute inset-0 bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900 opacity-90"></div>
        <div 
          className="absolute inset-0"
          style={{
            backgroundImage: `url("data:image/svg+xml,%3Csvg viewBox='0 0 400 400' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' /%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.3'/%3E%3C/svg%3E")`,
            animation: 'static 0.1s infinite'
          }}
        ></div>
        <button
          onClick={() => setScryingMode(false)}
          className="absolute top-4 right-4 z-10 px-6 py-3 bg-red-600 text-white rounded-lg hover:bg-red-700"
        >
          Exit Scrying
        </button>
        <style>{`
          @keyframes static {
            0% { opacity: 0.3; }
            50% { opacity: 0.5; }
            100% { opacity: 0.3; }
          }
        `}</style>
      </div>
    </div>
  );

  // Ritual Mode Component
  const RitualMode = ({ hour }) => {
    const corr = PLANET_CORRESPONDENCES[hour.planet.name];
    const hymn = ORPHIC_HYMNS[hour.planet.name];

    return (
      <div className="fixed inset-0 bg-black bg-opacity-95 z-50 overflow-y-auto">
        <div className="min-h-screen p-4">
          <button 
            onClick={() => setRitualMode(false)}
            className="mb-4 px-4 py-2 bg-purple-600 rounded-lg hover:bg-purple-700"
          >
            ‚Üê Back
          </button>
          
          <div className="max-w-4xl mx-auto bg-gradient-to-br from-indigo-950 to-purple-950 rounded-2xl p-8 border-2 border-yellow-600">
            <div className="text-center mb-8">
              <div className="text-8xl mb-4" style={{ color: hour.planet.color }}>
                {hour.planet.symbol}
              </div>
              <h2 className="text-4xl font-bold mb-2" style={{ color: hour.planet.color }}>
                Ritual of {hour.planet.name}
              </h2>
            </div>

            <div className="space-y-6">
              {/* Hexagram Instructions */}
              <div className="bg-black bg-opacity-40 rounded-xl p-6">
                <h3 className="text-2xl font-bold text-yellow-400 mb-4">Hexagram Ritual</h3>
                <div className="space-y-3 text-gray-200">
                  <p><strong className="text-purple-300">To Invoke {hour.planet.name}:</strong></p>
                  <ul className="list-disc list-inside space-y-2 ml-4">
                    <li>Draw first triangle CLOCKWISE from {hour.planet.name}'s point</li>
                    <li>Draw second triangle CLOCKWISE from opposite angle</li>
                    <li>Vibrate the Divine Names while tracing</li>
                  </ul>
                  <p className="mt-4"><strong className="text-purple-300">To Banish {hour.planet.name}:</strong></p>
                  <ul className="list-disc list-inside space-y-2 ml-4">
                    <li>Draw both triangles COUNTERCLOCKWISE</li>
                    <li>Begin from same point but reverse direction</li>
                  </ul>
                </div>
              </div>

              {/* Divine Names */}
              <div className="bg-black bg-opacity-40 rounded-xl p-6">
                <h3 className="text-2xl font-bold text-yellow-400 mb-4">Divine Names & Powers</h3>
                <div className="space-y-2 text-lg">
                  <p><strong className="text-purple-300">Divine Names:</strong> {corr.divineNames}</p>
                  <p><strong className="text-purple-300">Intelligence:</strong> {corr.intelligence}</p>
                  <p><strong className="text-purple-300">Spirit:</strong> {corr.spirit}</p>
                  <p><strong className="text-purple-300">Keywords:</strong> {corr.keywords}</p>
                  <p><strong className="text-purple-300">Power Words:</strong> {corr.powerWords}</p>
                </div>
              </div>

              {/* Orphic Hymn */}
              <div className="bg-black bg-opacity-40 rounded-xl p-6">
                <h3 className="text-2xl font-bold text-yellow-400 mb-4">Orphic Invocation to {hour.planet.name}</h3>
                <div className="italic text-gray-200 whitespace-pre-line leading-relaxed text-lg font-serif">
                  {hymn}
                </div>
              </div>

              {/* Correspondences */}
              <div className="bg-black bg-opacity-40 rounded-xl p-6">
                <h3 className="text-2xl font-bold text-yellow-400 mb-4">Sacred Correspondences</h3>
                <div className="grid md:grid-cols-2 gap-4">
                  <div>
                    <strong className="text-purple-300">Metal:</strong> {corr.metal}
                  </div>
                  <div>
                    <strong className="text-purple-300">Archangel:</strong> {corr.archangel}
                  </div>
                  <div className="md:col-span-2">
                    <strong className="text-purple-300">Incense:</strong> {corr.incense}
                  </div>
                  <div className="md:col-span-2">
                    <strong className="text-purple-300">Crystals:</strong> {corr.crystals}
                  </div>
                </div>
              </div>

              {/* Scrying Button */}
              <button
                onClick={() => {
                  setRitualMode(false);
                  setScryingMode(true);
                }}
                className="w-full bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 text-white font-bold py-4 rounded-xl text-xl flex items-center justify-center gap-2"
              >
                <Eye className="w-6 h-6" />
                Begin Scrying
              </button>
            </div>
          </div>
        </div>
      </div>
    );
  };

  // Hour Detail View
  const HourDetailView = ({ hour }) => {
    if (!hour) return null;
    
    const corr = PLANET_CORRESPONDENCES[hour.planet.name];
    
    return (
      <div className="fixed inset-0 bg-black bg-opacity-90 z-50 overflow-y-auto">
        <div className="min-h-screen p-4">
          <button 
            onClick={() => setSelectedHour(null)}
            className="mb-4 px-4 py-2 bg-purple-600 rounded-lg hover:bg-purple-700"
          >
            ‚Üê Back to Hours
          </button>
          
          <div className="max-w-4xl mx-auto bg-gradient-to-br from-purple-900 to-indigo-900 rounded-2xl p-8 border-2 border-yellow-600">
            <div className="text-center mb-8">
              <div className="text-8xl mb-4" style={{ color: hour.planet.color }}>
                {hour.planet.symbol}
              </div>
              <h2 className="text-4xl font-bold mb-2" style={{ color: hour.planet.color }}>
                Hour of {hour.planet.name}
              </h2>
              <div className="text-xl text-gray-300 mb-2">
                {formatTime(hour.start)} - {formatTime(hour.end)}
              </div>
              {currentHour?.planet.name === hour.planet.name && (
                <div className="text-lg text-yellow-400 font-bold">
                  {getTimeRemaining(hour.end)}
                </div>
              )}
              <div className="text-2xl mt-2">
                {hour.zodiac.symbol} {hour.zodiac.name}
              </div>
              <div className="text-sm text-gray-400 mt-2">
                {hour.isDayHour ? '‚òÄÔ∏è Day Hour (Sunrise to Sunset)' : 'üåô Night Hour (Sunset to Sunrise)'}
              </div>
              <div className="mt-3 flex gap-2 justify-center flex-wrap">
                <span className="px-3 py-1 bg-purple-700 rounded-full text-sm">
                  Dignity: {hour.dignity}
                </span>
                <span className={`px-3 py-1 rounded-full text-sm ${
                  hour.strength > 2 ? 'bg-green-700' : 
                  hour.strength > 0 ? 'bg-yellow-700' : 'bg-red-700'
                }`}>
                  Strength: {hour.strength}
                </span>
                {hour.natalMatch && (
                  <span className="px-3 py-1 bg-pink-700 rounded-full text-sm">
                    ‚≠ê Natal Resonance
                  </span>
                )}
              </div>
            </div>

            <div className="grid gap-6">
              <div className="bg-black bg-opacity-30 rounded-xl p-6">
                <h3 className="text-2xl font-bold text-yellow-400 mb-4">Planetary Power</h3>
                <div className="space-y-2">
                  <p><strong className="text-purple-300">Suitable For:</strong> {corr.suitable}</p>
                  <p><strong className="text-purple-300">Primary Action:</strong> {corr.action}</p>
                  <p><strong className="text-red-300">Caution:</strong> {corr.caution}</p>
                </div>
              </div>

              <div className="bg-black bg-opacity-30 rounded-xl p-6">
                <h3 className="text-2xl font-bold text-yellow-400 mb-4">Sacred Correspondences</h3>
                <div className="grid md:grid-cols-2 gap-4">
                  <div>
                    <div className="font-bold text-purple-300">Archangel:</div>
                    <div className="text-lg">{corr.archangel}</div>
                  </div>
                  <div>
                    <div className="font-bold text-purple-300">Intelligence:</div>
                    <div className="text-lg">{corr.intelligence}</div>
                  </div>
                  <div>
                    <div className="font-bold text-purple-300">Spirit:</div>
                    <div className="text-lg">{corr.spirit}</div>
                  </div>
                  <div>
                    <div className="font-bold text-purple-300">Metal:</div>
                    <div className="text-lg">{corr.metal}</div>
                  </div>
                  <div className="md:col-span-2">
                    <div className="font-bold text-purple-300">Incense:</div>
                    <div className="text-lg">{corr.incense}</div>
                  </div>
                  <div className="md:col-span-2">
                    <div className="font-bold text-purple-300">Crystals:</div>
                    <div className="text-lg">{corr.crystals}</div>
                  </div>
                </div>
              </div>

              <button
                onClick={() => {
                  setSelectedHour(null);
                  setRitualMode(true);
                  setSelectedHour(hour);
                }}
                className="w-full bg-gradient-to-r from-yellow-600 to-orange-600 hover:from-yellow-700 hover:to-orange-700 text-black font-bold py-4 rounded-xl text-xl flex items-center justify-center gap-2"
              >
                <Star className="w-6 h-6" />
                Begin Ritual
              </button>
            </div>
          </div>
        </div>
      </div>
    );
  };

  // Settings View
  const SettingsView = () => (
    <div className="max-w-2xl mx-auto space-y-6">
      <div className="bg-gradient-to-br from-purple-900 to-indigo-900 rounded-xl p-6 border border-purple-700">
        <h3 className="text-2xl font-bold text-yellow-400 mb-4">Location Settings</h3>
        <p className="text-gray-300 mb-4">This affects planetary hour calculations</p>
        <input
          type="text"
          value={locationInput}
          onChange={(e) => setLocationInput(e.target.value)}
          placeholder="City, State, Country (e.g., Los Angeles, CA, USA)"
          className="w-full bg-black bg-opacity-50 border border-purple-700 rounded-lg px-4 py-3 text-white mb-3"
        />
        <button
          onClick={updateLocation}
          className="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 rounded-lg"
        >
          Update Location
        </button>
        <div className="mt-3 text-sm text-gray-400">
          Current: {location.city}
        </div>
      </div>

      <div className="bg-gradient-to-br from-purple-900 to-indigo-900 rounded-xl p-6 border border-purple-700">
        <h3 className="text-2xl font-bold text-yellow-400 mb-4">Birth Data for Natal Chart</h3>
        <p className="text-gray-300 mb-4">For natal resonance calculations</p>
        
        <div className="space-y-3">
          <div>
            <label className="block text-gray-300 mb-2">Date of Birth</label>
            <input
              type="date"
              value={birthDateInput}
              onChange={(e) => setBirthDateInput(e.target.value)}
              className="w-full bg-black bg-opacity-50 border border-purple-700 rounded-lg px-4 py-3 text-white"
            />
          </div>
          
          <div>
            <label className="block text-gray-300 mb-2">Time of Birth (24-hour format)</label>
            <input
              type="time"
              value={birthTimeInput}
              onChange={(e) => setBirthTimeInput(e.target.value)}
              className="w-full bg-black bg-opacity-50 border border-purple-700 rounded-lg px-4 py-3 text-white"
            />
          </div>
          
          <div>
            <label className="block text-gray-300 mb-2">Birth Location</label>
            <input
              type="text"
              value={birthLocationInput}
              onChange={(e) => setBirthLocationInput(e.target.value)}
              placeholder="City, State, Country"
              className="w-full bg-black bg-opacity-50 border border-purple-700 rounded-lg px-4 py-3 text-white"
            />
          </div>
          
          <button
            onClick={saveBirthData}
            className="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 rounded-lg"
          >
            Save Birth Data
          </button>
          
          {birthData && (
            <div className="mt-3 text-sm text-gray-400">
              Current: {birthData.date} at {birthData.time}, {birthData.location}
            </div>
          )}
        </div>
      </div>
    </div>
  );

  // Electional View
  const ElectionalView = () => {
    const optimalHours = hours.filter(h => h.strength > 1 || h.natalMatch);
    
    return (
      <div>
        <h2 className="text-3xl font-bold text-center text-yellow-500 mb-4">
          Electional Hours Overview
        </h2>
        <p className="text-center text-gray-300 mb-6">
          Optimal hours for ceremonial operations highlighted by strength and natal resonance
        </p>
        
        <div className="grid gap-4">
          {hours.map((h, idx) => {
            const isActive = currentHour?.planet.name === h.planet.name && 
                             currentHour?.start.getTime() === h.start.getTime();
            const isOptimal = h.strength > 1 || h.natalMatch;
            const opacity = Math.min(0.9, 0.2 + h.strength / 4);
            
            return (
              <div 
                key={idx}
                onClick={() => setSelectedHour(h)}
                className={`bg-gradient-to-r from-purple-900 to-indigo-900 border-l-8 rounded-xl p-4 cursor-pointer transition hover:scale-105 ${
                  isActive ? 'ring-4 ring-yellow-500 shadow-2xl' : 'hover:ring-2 hover:ring-purple-500'
                } ${isOptimal ? 'border-r-4 border-r-green-500' : ''}`}
                style={{ 
                  borderLeftColor: h.planet.color,
                  backgroundColor: `rgba(88, 28, 135, ${opacity})`
                }}
              >
                <div className="flex justify-between items-center">
                  <div className="flex items-center gap-3">
                    <div className="text-4xl" style={{ color: h.planet.color }}>
                      {h.planet.symbol}
                    </div>
                    <div>
                      <div className="text-xl font-bold" style={{ color: h.planet.color }}>
                        {h.planet.name}
                      </div>
                      <div className="text-gray-300 text-sm">
                        {formatTime(h.start)} - {formatTime(h.end)}
                      </div>
                    </div>
                  </div>
                  <div className="text-right space-y-1">
                    <div className="text-xl">{h.zodiac.symbol} {h.zodiac.name}</div>
                    <div className={`text-xs px-2 py-1 rounded ${
                      h.strength > 2 ? 'bg-green-700' :
                      h.strength > 0 ? 'bg-yellow-700' : 'bg-red-700'
                    }`}>
                      {h.dignity} ‚Ä¢ Str: {h.strength}
                    </div>
                    {h.natalMatch && (
                      <div className="text-xs px-2 py-1 bg-pink-700 rounded">
                        ‚≠ê Resonant
                      </div>
                    )}
                    {isOptimal && (
                      <div className="text-xs px-2 py-1 bg-green-600 rounded font-bold">
                        OPTIMAL
                      </div>
                    )}
                  </div>
                </div>
              </div>
            );
          })}
        </div>
      </div>
    );
  };

  // Natal Chart View
  const NatalChartView = () => {
    if (!natalChart) {
      return (
        <div className="text-center py-12">
          <p className="text-xl text-gray-300 mb-4">No birth data set</p>
          <button
            onClick={() => setCurrentView('settings')}
            className="px-6 py-3 bg-purple-600 hover:bg-purple-700 rounded-lg"
          >
            Go to Settings to Add Birth Data
          </button>
        </div>
      );
    }

    return (
      <div>
        <h2 className="text-3xl font-bold text-center text-yellow-500 mb-6">
          Your Natal Chart
        </h2>
        {birthData && (
          <p className="text-center text-gray-300 mb-6">
            Born {birthData.date} at {birthData.time} in {birthData.location}
          </p>
        )}
        
        <div className="grid gap-4">
          {natalChart.map((item, idx) => (
            <div 
              key={idx}
              className="bg-gradient-to-r from-purple-900 to-indigo-900 rounded-xl p-4 border border-purple-700"
            >
              <div className="flex justify-between items-center">
                <div className="flex items-center gap-4">
                  <div className="text-5xl" style={{ color: PLANET_DETAILS[item.planet].color }}>
                    {PLANET_DETAILS[item.planet].symbol}
                  </div>
                  <div>
                    <div className="text-2xl font-bold" style={{ color: PLANET_DETAILS[item.planet].color }}>
                      {item.planet}
                    </div>
                    <div className="text-gray-400 text-sm">
                      {item.longitude.toFixed(2)}¬∞
                    </div>
                  </div>
                </div>
                <div className="text-right">
                  <div className="text-4xl">{item.zodiac.symbol}</div>
                  <div className="text-xl text-gray-300">{item.zodiac.name}</div>
                </div>
              </div>
            </div>
          ))}
        </div>
      </div>
    );
  };

  // Correspondences Table View
  const CorrespondencesView = () => (
    <div className="overflow-x-auto">
      <h2 className="text-3xl font-bold text-center text-yellow-500 mb-6">
        Planetary Correspondences
      </h2>
      <table className="w-full border-collapse text-sm">
        <thead>
          <tr className="bg-purple-900">
            <th className="border border-purple-700 p-3 text-left">Planet</th>
            <th className="border border-purple-700 p-3 text-left">Archangel</th>
            <th className="border border-purple-700 p-3 text-left">Intelligence</th>
            <th className="border border-purple-700 p-3 text-left">Spirit</th>
            <th className="border border-purple-700 p-3 text-left">Metal</th>
            <th className="border border-purple-700 p-3 text-left">Suitable For</th>
          </tr>
        </thead>
        <tbody>
          {Object.entries(PLANET_CORRESPONDENCES).map(([planet, data]) => (
            <tr key={planet} className="bg-purple-900 bg-opacity-30 hover:bg-opacity-50">
              <td className="border border-purple-700 p-3">
                <span style={{ color: PLANET_DETAILS[planet].color }} className="text-lg">
                  {PLANET_DETAILS[planet].symbol} {planet}
                </span>
              </td>
              <td className="border border-purple-700 p-3">{data.archangel}</td>
              <td className="border border-purple-700 p-3">{data.intelligence}</td>
              <td className="border border-purple-700 p-3">{data.spirit}</td>
              <td className="border border-purple-700 p-3">{data.metal}</td>
              <td className="border border-purple-700 p-3">{data.suitable}</td>
            </tr>
          ))}
        </tbody>
      </table>
    </div>
  );

  return (
    <div className="min-h-screen bg-gradient-to-br from-gray-900 via-purple-900 to-black text-gray-100">
      {scryingMode && <ScryingMode />}
      {ritualMode && selectedHour && <RitualMode hour={selectedHour} />}
      {selectedHour && !ritualMode && <HourDetailView hour={selectedHour} />}
      
      <header className="bg-black bg-opacity-50 backdrop-blur-lg border-b-2 border-yellow-600 sticky top-0 z-40">
        <div className="container mx-auto px-4 py-4">
          <h1 className="text-3xl md:text-4xl font-bold text-center text-yellow-500 mb-2">
            ‚≠ê PLANETARY HOURS ‚≠ê
          </h1>
          <div className="text-center text-gray-300 text-sm mb-3">
            {currentDate.toLocaleDateString('en-US', { 
              weekday: 'long', 
              year: 'numeric', 
              month: 'long', 
              day: 'numeric' 
            })}
          </div>
          {currentHour && (
            <div className="text-center bg-gradient-to-r from-purple-800 to-indigo-800 rounded-lg p-3 mb-3 border border-yellow-600">
              <div className="text-sm text-gray-300 mb-1">Current Planetary Hour</div>
              <div className="flex items-center justify-center gap-2">
                <span className="text-3xl" style={{ color: currentHour.planet.color }}>
                  {currentHour.planet.symbol}
                </span>
                <span className="text-2xl font-bold" style={{ color: currentHour.planet.color }}>
                  {currentHour.planet.name}
                </span>
              </div>
              <div className="text-sm text-gray-300 mt-1">
                {formatTime(currentHour.start)} - {formatTime(currentHour.end)}
              </div>
              <div className="text-xs text-yellow-400 mt-1">
                {getTimeRemaining(currentHour.end)}
              </div>
            </div>
          )}
          <div className="text-center text-gray-400 text-sm mb-3">
            <div>Day Ruler: <span style={{ color: PLANET_DETAILS[DAY_RULERS[currentDate.getDay()]].color }}>
              {PLANET_DETAILS[DAY_RULERS[currentDate.getDay()]].symbol} {DAY_RULERS[currentDate.getDay()]}
            </span> ({DAY_NAMES[currentDate.getDay()]})</div>
            <div className="text-xs mt-1">{location.city}</div>
          </div>
          <div className="flex flex-wrap gap-2 justify-center">
            <button 
              onClick={() => setCurrentView('hours')}
              className={`px-4 py-2 rounded-lg transition ${currentView === 'hours' ? 'bg-yellow-600 text-black' : 'bg-purple-700 hover:bg-purple-600'}`}
            >
              Today's Hours
            </button>
            <button 
              onClick={() => setCurrentView('electional')}
              className={`px-4 py-2 rounded-lg transition ${currentView === 'electional' ? 'bg-yellow-600 text-black' : 'bg-purple-700 hover:bg-purple-600'}`}
            >
              Electional
            </button>
            <button 
              onClick={() => setCurrentView('natal')}
              className={`px-4 py-2 rounded-lg transition ${currentView === 'natal' ? 'bg-yellow-600 text-black' : 'bg-purple-700 hover:bg-purple-600'}`}
            >
              Natal Chart
            </button>
            <button 
              onClick={() => setCurrentView('correspondences')}
              className={`px-4 py-2 rounded-lg transition ${currentView === 'correspondences' ? 'bg-yellow-600 text-black' : 'bg-purple-700 hover:bg-purple-600'}`}
            >
              Correspondences
            </button>
            <button 
              onClick={() => setCurrentView('settings')}
              className={`px-4 py-2 rounded-lg transition ${currentView === 'settings' ? 'bg-yellow-600 text-black' : 'bg-purple-700 hover:bg-purple-600'}`}
            >
              <Settings className="w-4 h-4 inline mr-1" />
              Settings
            </button>
          </div>
        </div>
      </header>

      <main className="container mx-auto px-4 py-6">
        {currentView === 'hours' && (
          <div className="grid gap-4">
            {hours.map((h, idx) => {
              const isActive = currentHour?.planet.name === h.planet.name && 
                               currentHour?.start.getTime() === h.start.getTime();
              return (
                <div 
                  key={idx}
                  onClick={() => setSelectedHour(h)}
                  className={`bg-gradient-to-r from-purple-900 to-indigo-900 border-l-8 rounded-xl p-4 cursor-pointer transition hover:scale-105 ${
                    isActive ? 'ring-4 ring-yellow-500 shadow-2xl' : 'hover:ring-2 hover:ring-purple-500'
                  }`}
                  style={{ borderLeftColor: h.planet.color }}
                >
                  <div className="flex justify-between items-start">
                    <div className="flex items-center gap-3">
                      <div className="text-5xl" style={{ color: h.planet.color }}>
                        {h.planet.symbol}
                      </div>
                      <div>
                        <div className="text-2xl font-bold" style={{ color: h.planet.color }}>
                          {h.planet.name}
                        </div>
                        <div className="text-gray-300">
                          {formatTime(h.start)} - {formatTime(h.end)}
                        </div>
                        <div className="text-sm text-gray-400">
                          {h.isDayHour ? '‚òÄÔ∏è Day Hour' : 'üåô Night Hour'}
                        </div>
                      </div>
                    </div>
                    <div className="text-right">
                      <div className="text-3xl">{h.zodiac.symbol}</div>
                      <div className="text-sm text-gray-300">{h.zodiac.name}</div>
                      <div className="text-xs text-gray-400 mt-1">{h.dignity}</div>
                      <div className={`text-xs mt-1 px-2 py-1 rounded ${
                        h.strength > 2 ? 'bg-green-700' :
                        h.strength > 0 ? 'bg-yellow-700' : 'bg-red-700'
                      }`}>
                        Strength: {h.strength}
                      </div>
                      {h.natalMatch && (
                        <div className="text-xs mt-1 px-2 py-1 bg-pink-700 rounded">
                          ‚≠ê Natal Match
                        </div>
                      )}
                      {isActive && (
                        <div className="mt-2 px-3 py-1 bg-yellow-600 text-black rounded-full text-xs font-bold">
                          ACTIVE NOW
                        </div>
                      )}
                    </div>
                  </div>
                </div>
              );
            })}
          </div>
        )}
        
        {currentView === 'electional' && <ElectionalView />}
        {currentView === 'natal' && <NatalChartView />}
        {currentView === 'correspondences' && <CorrespondencesView />}
        {currentView === 'settings' && <SettingsView />}
      </main>
    </div>
  );
};

export default PlanetaryHoursApp;
